CSDN博客地址：https://blog.csdn.net/skye_fly?spm=1001.2014.3001.5343
里面记录了一些自己开发该平台时遇到的问题，大家可以参考浏览。另外，大家多多标星哦！（开源让世界更美好）

1. 关于行车路径绘制以及经纬度导出、转换的操作请看MapData文件夹

2. 关于阿里云云端服务器的搭建请看Ali_Cloud文件夹

3. 客户端程序main_client.py，注意上位机与下位机之间通信的协议要按照你们团队自己的规定

4. 开发该项目时由于只有一台移动终端，所以对于多终端的通信程序没有优化，而是直接暴力的复制程序，有需要的话应该模块化程序，提高程序复用率，降低耦合，大家可以自主进行优化。


在自己电脑上独立测试和与下位机联调时要注意unpack方法中采用的大端还是小端格式 （我们下位机使用的C++语言编写，上位机使用Python语言编写，通过Socket传输数据包拆包时有一个大端和小端的区别）


****************************** 以下是我自己开发时遇到的一些问题以及解决方法，如果有需要可以参考 *****************
/////////////////////////////////////////////////////////////////////////////////////////////////////////////////////


========================================读取小车上传的经纬度并更新地图

实时更新百度地图显示小车位置：main v3.py 
读取的是文件“shangchuan_lnglat.txt”里的经纬度数据（先将小车上传的经纬度数据（转换成百度地图经纬度格式bd-09，可以通过处理奥维地图数据转换的程序来转换）保存到该文件中），然后由latlng_export.py程序将经纬度数据写入文件“lat_lng.txt”中，每行一个数据，然后在main v3.py 中的fun_time函数中写入weather.json文件中


*****************文件夹命名改了main.py程序里的各个路径也要改*********************************


注意连接自己的网络时要切换程序里的ip绑定，不然会闪退


注意打开网络调试助手做server时，ip每次都会变，main.py程序里的client部分连接的ip也要跟着变（所以统一连接阿里云服务器可以避免切换ip和端口号）
server部分和client部分要用不同的ip





实时更新百度地图显示小车位置：main v3.py 
读取的是文件“shangchuan_lnglat.txt”里的经纬度数据（先将小车上传的经纬度数据（转换成百度地图经纬度格式bd-09，可以通过处理奥维地图数据转换的程序来转换）保存到该文件中），然后由latlng_export.py程序将经纬度数据写入文件“lat_lng.txt”中，每行一个数据，然后在main v3.py 中的fun_time函数中写入weather.json文件中


main v4.py:
首先在Listener数据接收部分将小车上传的经纬度写到文件“before_lat_lng.txt”中，然后调用函数fun_timer，先调用wgs84_to_bd09_change.py将谷歌经纬度数据转换成百度经纬度保存到lat_lng.txt中，再将更新后的“lat_lng.txt”中的经纬度写入weather.json文件中。最后在UI主线程中的导航地图显示程序部分调用map_load2.py外部程序，载入BD_map.html程序（里面通过调用weather.json实现小车位置实时更新）
记得改wgs84_to_bd09....里面的pathIn和pathout2


final_version:E:\pycharm_project\TCP 10 25\main.py

换了一个文件夹后要记得改UI程序部分BD_map.html程序的绝对路径


如果地图蓝屏了复制E:\pycharm_project\TCP 10 22\main_BDjingweidu.py重新改写代码

如果小车静止不动 map_load2.py里面要改BD_map.html文件路径

========================================读取小车上传的经纬度并更新地图


emit发送小车上传的经纬度给UI界面时，延时不能太大，不然小车上发经纬度数据的频率变大的话程序会崩溃





++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++
为了程序不在dataFromCar = client.recv(1024) 处卡死，需要建立一个线程来调用接收数据函数（def read_thread_method），将这句话写到接收数据函数里面,同时在线程外循环检测按钮是否被激活
为了用云端的服务器：将main v2.py改成客户端main_client.py


上位机下发时double前面会增加00000000四个字节，所以显示的还是128个字节
读取经纬度数据的时候不再sleep，
解包的时候大端小端要分清，而且判断包长度不能出错（该方法不安全，所以应该每次读数据的时候都顺序读，读到dddddddd的时候再进行下一步判断）


=======================================================11/4日
两个问题：
（1）
一个在一开始读取数据时，一个字节一个字节读取，判断读到包头再读取余下的27个字节（数据域前的，可以据此判断上传的是什么指令，而且可以知道接下来还要读多少个字节，同时可以防止丢包导致的上一次字节流没读完，指针位置不在包头的问题）
（2）
跟自己的网络调试助手调的时候pack/unpack需要加！，跟龙德调的时候不加！
（3）
编写客户端，用两个线程以不同频率发送经纬度数据和车辆状态数据，看看是否能同时在上位机上更新（可以的话不在UI界面上显示小车的实时经纬度，有了百度地图已经可以直观看出小车的位置了。）


用main_v3_jiancebaotou.py程序，与龙德联调时删去！
阿里云调试时用main_client_v3_jiancebaotou.py(包含！)以及TCP_client learning.py



=============================================================11/5
接收数据的时候Byte型变量与double型变量之间存在字节对齐问题，需要先读完byte型变量在以double变量开头读取剩下的数据

main v4_image_autoask.py 上位机每隔一定时间下发图像和状态请求指令


===================================================11/6
服务器：main v4_image_autoask.py
客户端：main_client_v4_jiancebaotou_autoask.py

===============================================11/10
服务器：main v4_image_autoask.py
客户端：main_client_v5.py


================================================11/15
在上位机程序main_client_v6_MySQL.py中的经纬度和状态数据接收程序段插入MySQL_cloud_insert.py程序，将收到的数据写入数据表中。

服务器： main v5_image_autoask_MySQL.py
客户端： main_client_v6_MySQL.py

在自己电脑上测试时用：
客户端： main_client_v6_MySQL_tanhao.py

===============================================11/30
增加多个终端的界面切换 main_client_v7_MySQL_MultiUI.py
按send按钮不发送消息（每个界面的sendFlag要区别sendFlag_ID1,取消两处注释）
第二辆车状态、图像请求指令发送不了（请求线程区分askstate_thread_ID2，对应的方法区分askstate_method_ID2，两个方法中加入全局变量global askimageFlag_ID2、global askstateFlag_ID2）

Ali云服务器第四辆小车开始接受数据异常（前三辆车ID区分，后面的变量是不是没有区分ID，后面的没有加感叹号）




========================================12/1
上位机界面接受数据（第一个界面可以更新，后面的不能更新：Sig信号ID有没有区分？数据库程序块？调用fun_time方法的线程重名了？）fun_time_ID、lng_ID、weather2.json
**  一直在执行Listener1程序块里的程序（所以修改Listener2一直没用：云服务器send_to_up没有区分ID）
** 从页面2跳转回页面1后之前的界面上的数据都没了
第二辆车开始上发的数据指令解析错误，一直在逐个读取字节（其实已经跳出了循环，只是后面的程序不需要判断是否是本车上发的数据+++++UI程序中tcp_socket要加ID吗？阿里云程序中recv_from_car要加ID吗？）

切换界面后再返回原界面通信断开（选择不隐藏界面，直接新建界面）

=========================================12/2
实现多终端通信多窗口显示数据  main_client_v8_10Car_tanhao.py


======================================12/4
在接收图像数据部分，循环检测包尾，直到读完四个包尾后才结束，如果阿里云没有发送包尾数据则程序卡死在这里
main_client_v9_ImageThread.py  ：单独一个线程去读取图像数据  每辆车tcp_socket_ID区分


============================================================12/8
main_client_v9_NoThread.py：
  读取图像数据时不建立单独的线程，多线程可能会导致数据读取错乱
  读取获得的图片的大小，判断和接收到的字节数是否一致，打印少读取的字节数个数（看收到的图像大小和龙德电脑上的图像大小是否一致）
  有可能判断剩余字节数大于1024，但是recv这一次收到的不足1024（打印每次recv到的buffer的长度，参考CSDN）
  可能加入的 socket.MSG_WAITALL导致图片读取失败，可以注释
  经测试我的电脑recv单次最大接受21962字节数据

==================================================
time.time()查看处理一次数据接收用时
图像不缩放更新会快一点，主要是emit发送到UI界面显示比较慢
阿里云不print数据加快速度  
同时发送经纬度数据变慢
经纬度数据处理时不用两个线程
main_client_v9_NoThread.py：
	经纬度每秒一次，图像20秒一次
	setPixmap设置图片自适应label大小，增大图像显示框
修改：
	1、阿里云不print
	2、经纬度、图像数据处理
	3、UI界面程序块setPixmap设置
	

